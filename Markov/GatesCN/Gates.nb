(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     34431,        846]
NotebookOptionsPosition[     32953,        810]
NotebookOutlinePosition[     33318,        826]
CellTagsIndexPosition[     33275,        823]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Functions", "Section",
 CellChangeTimes->{{3.795367827465465*^9, 
  3.795367831057701*^9}},ExpressionUUID->"b852c9ed-45db-4036-9364-\
e2e73134bb82"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ReplaceDiagonal", "[", "m_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mat", "=", "m"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Scan", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"mat", "[", 
            RowBox[{"[", 
             RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "=", "0"}], ")"}],
          "&"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "i"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "m"}]}], "}"}]}], "]"}]}], "]"}], ";", 
      "mat"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"originalColorsValues", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"70", ",", "50", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "100", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"100", ",", "100", ",", "100", ",", "100"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"colorPalette", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"CMYKColor", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "100"}], ",", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", "100"}], ",", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "/", "100"}], ",", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "/", "100"}]}], "]"}], "&"}], "/@", 
    "originalColorsValues"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hexToRGB", "=", 
   RowBox[{
    RowBox[{"RGBColor", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"IntegerDigits", "[", 
        RowBox[{
         RowBox[{"ToExpression", "@", 
          RowBox[{"StringReplace", "[", 
           RowBox[{"#", ",", 
            RowBox[{"\"\<#\>\"", "\[Rule]", "\"\<16^^\>\""}]}], "]"}]}], ",", 
         "256", ",", "3"}], "]"}], "/", "255."}], ")"}]}], "&"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MapProcess", "[", 
    RowBox[{
    "freqs_", ",", " ", "pops_", ",", " ", "latLon_", ",", "max_", ",", 
     "countryName_", ",", "surv_", ",", "over_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scA", "=", "10000"}], ",", 
       RowBox[{"scB", "=", "35000"}], ",", " ", 
       RowBox[{"scC", "=", ".0005"}], ",", " ", 
       RowBox[{"cA", "=", "\"\<#1e59fc\>\""}], ",", " ", 
       RowBox[{"cB", "=", "\"\<#ff007f\>\""}], ",", 
       RowBox[{"cC", "=", "\"\<#7737d6\>\""}]}], "\[IndentingNewLine]", "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{"GeoGraphics", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GeoStyling", "[", 
          RowBox[{
           RowBox[{"EdgeForm", "[", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"Opacity", "[", "0", "]"}], ",", 
              RowBox[{"Thickness", "[", ".05", "]"}], ",", 
              RowBox[{"Darker", "[", 
               RowBox[{
                RowBox[{"colorPalette", "[", 
                 RowBox[{"[", "5", "]"}], "]"}], ",", ".06"}], "]"}]}], "]"}],
             "]"}], ",", 
           RowBox[{"Opacity", "[", "0", "]"}], ",", 
           RowBox[{"colorPalette", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"CountryData", "[", 
          RowBox[{"countryName", ",", "\"\<SchematicPolygon\>\""}], "]"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"GeoStyling", "[", 
          RowBox[{
           RowBox[{"EdgeForm", "[", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"Opacity", "[", "0", "]"}], ",", 
              RowBox[{"Thickness", "[", ".1", "]"}], ",", 
              RowBox[{"colorPalette", "[", 
               RowBox[{"[", "5", "]"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"Opacity", "[", "0", "]"}], ",", 
           RowBox[{"colorPalette", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"CountryData", "[", 
          RowBox[{"countryName", ",", "\"\<SchematicPolygon\>\""}], "]"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"GeoStyling", "[", 
          RowBox[{
           RowBox[{"EdgeForm", "[", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"Opacity", "[", "0", "]"}], ",", 
              RowBox[{"Thickness", "[", ".030", "]"}], ",", 
              RowBox[{"colorPalette", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"Opacity", "[", "0", "]"}], ",", 
           RowBox[{"colorPalette", "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"CountryData", "[", 
          RowBox[{"countryName", ",", "\"\<Polygon\>\""}], "]"}]}], 
        "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
       RowBox[{"AspectRatio", "\[Rule]", "Automatic"}], "\[IndentingNewLine]",
        ",", 
       RowBox[{"Axes", "\[Rule]", "False"}], "\[IndentingNewLine]", ",", 
       RowBox[{"Frame", "\[Rule]", "True"}], "\[IndentingNewLine]", ",", 
       RowBox[{"FrameStyle", "\[Rule]", 
        RowBox[{"Directive", "[", 
         RowBox[{
          RowBox[{"colorPalette", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", 
          RowBox[{"Thickness", "[", ".0035", "]"}]}], "]"}]}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"FrameTicks", "\[Rule]", "None"}], "\[IndentingNewLine]", ",", 
       
       RowBox[{"FrameTicksStyle", "\[Rule]", "Black"}], "\[IndentingNewLine]",
        ",", 
       RowBox[{"GridLines", "\[Rule]", "Automatic"}], "\[IndentingNewLine]", 
       ",", 
       RowBox[{"GridLinesStyle", "\[Rule]", 
        RowBox[{"Directive", "[", 
         RowBox[{"{", 
          RowBox[{"Dashed", ",", 
           RowBox[{"Opacity", "[", ".25", "]"}], ",", 
           RowBox[{"Thickness", "[", ".001", "]"}], ",", "Black"}], "}"}], 
         "]"}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"ImageSize", "\[Rule]", "1500"}], "\[IndentingNewLine]", ",", 
       RowBox[{"GeoBackground", "\[Rule]", "None"}], "\[IndentingNewLine]", 
       ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"6.6", ",", "6.75"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0.25", ",", ".4"}], "}"}]}], "}"}]}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"(*", "Centrality", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Lighter", "[", 
           RowBox[{
            RowBox[{"hexToRGB", "[", "cA", "]"}], ",", ".25"}], "]"}], ",", 
          RowBox[{"Opacity", "[", ".25", "]"}], ",", 
          RowBox[{"EdgeForm", "[", 
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Thickness", "[", ".002", "]"}], ",", 
             RowBox[{"Dashing", "[", "1", "]"}], ",", 
             RowBox[{"Opacity", "[", "1", "]"}], ",", 
             RowBox[{"hexToRGB", "[", "cA", "]"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Disk", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "scC"}]}], "]"}], "&"}], 
           "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Reverse", "/@", "latLon"}], ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"scA", "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"pops", "/", 
                    RowBox[{"Max", "[", "pops", "]"}]}], "/", "scB"}], ")"}], 
                 "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"freqs", "/", "max"}], "/", "scB"}], ")"}]}], 
                ")"}], 
               RowBox[{"1", "/", "2"}]]}], "}"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", "Surveillance", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"hexToRGB", "[", "cB", "]"}], ",", 
          RowBox[{"Opacity", "[", "0", "]"}], ",", 
          RowBox[{"EdgeForm", "[", 
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Thickness", "[", ".002", "]"}], ",", 
             RowBox[{"Dashing", "[", "1", "]"}], ",", 
             RowBox[{"Opacity", "[", "1", "]"}], ",", 
             RowBox[{"hexToRGB", "[", "cB", "]"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Disk", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "scC"}]}], "]"}], "&"}], 
           "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Reverse", "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"latLon", "[", 
                   RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "surv"}], 
                ")"}]}], ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"scA", "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"pops", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "surv"}], 
                    ")"}], "/", 
                    RowBox[{"Max", "[", "pops", "]"}]}], "/", "scB"}], ")"}], 
                 "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"freqs", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "surv"}], 
                    ")"}], "/", "max"}], "/", "scB"}], ")"}]}], ")"}], 
               RowBox[{"1", "/", "2"}]]}], "}"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", "Overrun", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"hexToRGB", "[", "cC", "]"}], ",", 
          RowBox[{"Opacity", "[", "0", "]"}], ",", 
          RowBox[{"EdgeForm", "[", 
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Thickness", "[", ".002", "]"}], ",", 
             RowBox[{"Dashing", "[", "1", "]"}], ",", 
             RowBox[{"Opacity", "[", "1", "]"}], ",", 
             RowBox[{"hexToRGB", "[", "cC", "]"}]}], "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Disk", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "scC"}]}], "]"}], "&"}], 
           "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Reverse", "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"latLon", "[", 
                   RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "over"}], 
                ")"}]}], ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"scA", "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"pops", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "over"}], 
                    ")"}], "/", 
                    RowBox[{"Max", "[", "pops", "]"}]}], "/", "scB"}], ")"}], 
                 "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"freqs", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "over"}], 
                    ")"}], "/", "max"}], "/", "scB"}], ")"}]}], ")"}], 
               RowBox[{"1", "/", "2"}]]}], "}"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", "PopSize", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Darker", "[", 
           RowBox[{
            RowBox[{"hexToRGB", "[", "cA", "]"}], ",", "0"}], "]"}], ",", 
          RowBox[{"Opacity", "[", ".001", "]"}], ",", 
          RowBox[{"EdgeForm", "[", 
           RowBox[{"Directive", "[", 
            RowBox[{
             RowBox[{"Thickness", "[", ".003", "]"}], ",", 
             RowBox[{"Dashing", "[", ".0025", "]"}], ",", 
             RowBox[{"Opacity", "[", ".05", "]"}], ",", 
             RowBox[{"Darker", "[", 
              RowBox[{
               RowBox[{"hexToRGB", "[", "cA", "]"}], ",", ".1"}], "]"}]}], 
            "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Disk", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "scC"}]}], "]"}], "&"}], 
           "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Reverse", "/@", "latLon"}], ",", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"pops", "/", 
                  RowBox[{"Max", "[", "pops", "]"}]}], "/", "scB"}], ")"}], 
               RowBox[{"1", "/", "2"}]]}], "}"}], "]"}]}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HistProcess", "[", 
   RowBox[{"steps_", ",", "migration_", ",", "max_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Histogram", "[", 
     RowBox[{"steps", ",", 
      RowBox[{"migration", "//", "Length"}], "\[IndentingNewLine]", ",", 
      RowBox[{"AspectRatio", "\[Rule]", ".1"}], "\[IndentingNewLine]", ",", 
      RowBox[{"Axes", "\[Rule]", "False"}], "\[IndentingNewLine]", ",", 
      RowBox[{"ChartStyle", "\[Rule]", 
       RowBox[{"Directive", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"EdgeForm", "[", 
           RowBox[{"Directive", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"hexToRGB", "[", "\"\<#80A1FC\>\"", "]"}], ",", 
              RowBox[{"Opacity", "[", "0", "]"}], ",", "Thick"}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"Opacity", "[", ".5", "]"}], ",", 
          RowBox[{"hexToRGB", "[", "\"\<#80A1FC\>\"", "]"}]}], "}"}], "]"}]}],
       "\[IndentingNewLine]", ",", 
      RowBox[{"Frame", "\[Rule]", "True"}], "\[IndentingNewLine]", ",", 
      RowBox[{"FrameStyle", "\[Rule]", 
       RowBox[{"Directive", "[", 
        RowBox[{
         RowBox[{"colorPalette", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", 
         RowBox[{"Thickness", "[", ".0035", "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"FrameTicks", "\[Rule]", "None"}], "\[IndentingNewLine]", ",", 
      RowBox[{"ImageSize", "\[Rule]", "1500"}], "\[IndentingNewLine]", ",", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"migration", "//", "Length"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "max"}], "}"}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellChangeTimes->{{3.795363937547575*^9, 3.79536394931841*^9}, {
   3.7953640881982193`*^9, 3.795364104619007*^9}, {3.795367735320448*^9, 
   3.795367743254055*^9}, {3.795367820057014*^9, 3.795367824325094*^9}, {
   3.795377642104388*^9, 3.795377645937508*^9}, {3.795380730687224*^9, 
   3.7953807400192823`*^9}, {3.795394071869163*^9, 3.795394082498006*^9}, {
   3.795394182918858*^9, 3.795394186465023*^9}, {3.795394237963194*^9, 
   3.795394265427479*^9}, {3.795394302813395*^9, 3.795394316655933*^9}, {
   3.795394416274136*^9, 3.79539441944557*^9}, {3.795394957904023*^9, 
   3.7953949599263363`*^9}, {3.7954434595147867`*^9, 3.795443462176236*^9}, {
   3.795443607803546*^9, 3.7954436426338587`*^9}, {3.795443820559422*^9, 
   3.795443856831971*^9}, {3.79544422860093*^9, 3.795444231398427*^9}, {
   3.7954443133150873`*^9, 3.795444316126285*^9}, {3.7954445151441936`*^9, 
   3.795444516510767*^9}, {3.795446782974883*^9, 3.7954467972149363`*^9}, {
   3.795447292146117*^9, 3.79544731216855*^9}, 3.795447703698779*^9, {
   3.795447738456094*^9, 3.795447741039782*^9}, {3.795447893196435*^9, 
   3.7954478955462227`*^9}, {3.7954479280959053`*^9, 3.795448052792038*^9}, {
   3.795451336365148*^9, 3.795451340607771*^9}, {3.795452152980423*^9, 
   3.795452171453871*^9}, {3.795453161929228*^9, 3.795453168453026*^9}, {
   3.795453208696433*^9, 3.7954532120248747`*^9}, {3.7954532495444403`*^9, 
   3.795453257005777*^9}, {3.795453522865033*^9, 3.7954535335539494`*^9}, {
   3.7954535889450293`*^9, 3.795453598051486*^9}, {3.795457645084447*^9, 
   3.7954576935397043`*^9}, {3.795457824256525*^9, 3.795457824626956*^9}, {
   3.7954585305307207`*^9, 3.7954585495922623`*^9}, {3.79545859781463*^9, 
   3.795458597865349*^9}, {3.7954588140437727`*^9, 3.795458853800535*^9}, {
   3.795458979232252*^9, 3.795458979506678*^9}, {3.795459542778351*^9, 
   3.795459574192691*^9}, {3.795459610472168*^9, 3.795459684074423*^9}, {
   3.795459850247283*^9, 3.7954598792213287`*^9}, {3.795460163231573*^9, 
   3.795460229366118*^9}, {3.7954602649044657`*^9, 3.795460382438794*^9}, {
   3.7954609163342113`*^9, 
   3.7954609984215937`*^9}},ExpressionUUID->"3cd9284b-8809-416a-9918-\
e16787c084da"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Load Data", "Section",
 CellChangeTimes->{{3.795367834403121*^9, 
  3.795367837863332*^9}},ExpressionUUID->"e0e0fe40-c61e-4d1f-810d-\
fb18d5e7570f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bPath", "=", " ", "\"\<./kernels_cluster/\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lonLatPop", "=", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"bPath", "<>", "\"\<stp_cluster_sites_pop.csv\>\""}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ";;", "All"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"migration", "=", 
    RowBox[{"Import", "[", 
     RowBox[{"bPath", "<>", "\"\<kernel_cluster_2500_2.csv\>\""}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"latLon", "=", 
   RowBox[{"Reverse", "/@", 
    RowBox[{"lonLatPop", "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", 
       RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pops", "=", 
   RowBox[{
    RowBox[{"Log", "[", 
     RowBox[{"lonLatPop", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}], "//", "N"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7953601122980747`*^9, 3.795360118745537*^9}, {
  3.7953601814200087`*^9, 3.795360281625147*^9}, {3.795360317874412*^9, 
  3.7953603716506453`*^9}, {3.7953646552714567`*^9, 3.795364712401043*^9}, {
  3.7953673844553833`*^9, 3.795367384885187*^9}, {3.795373315713558*^9, 
  3.7953733163534*^9}, {3.795458370812973*^9, 3.795458373344531*^9}, {
  3.7954584229965267`*^9, 3.7954584234157953`*^9}},
 CellLabel->
  "In[234]:=",ExpressionUUID->"f619571b-c8a7-4707-b736-0bf5e8251a3a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Markov Process", "Section",
 CellChangeTimes->{{3.7953807632997847`*^9, 
  3.795380769926614*^9}},ExpressionUUID->"7d0a4ee2-5fa2-46c6-9918-\
92389b686312"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sp", ",", "rep"}], "}"}], "=", 
    RowBox[{"{", 
     RowBox[{"750", ",", "2000"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "Simulate", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initialState", "=", 
   RowBox[{
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", 
      RowBox[{"migration", "//", "Length"}]}], "]"}], "//", 
    RowBox[{
     RowBox[{"ReplacePart", "[", 
      RowBox[{"#", ",", 
       RowBox[{"258", "\[Rule]", "1"}]}], "]"}], "&"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"markov", "=", 
   RowBox[{"DiscreteMarkovProcess", "[", 
    RowBox[{"initialState", ",", "migration"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MarkovProcessProperties", "[", 
    RowBox[{"markov", ",", "\"\<LimitTransitionMatrix\>\""}], "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"simTraces", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"RandomFunction", "[", 
      RowBox[{"markov", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "sp"}], "}"}], ",", "rep"}], "]"}], "//", 
     "Normal"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"steps", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "2"}], "]"}], "]"}], "&"}], "/@", "simTraces"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"max", ",", "maxTwo"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Tally", "[", 
        RowBox[{"steps", "//", "Flatten"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "//", "Max"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Tally", "[", 
        RowBox[{"steps", "//", "Flatten"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}], "//", "Max"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7953675235207*^9, 3.795367528320244*^9}, {
   3.795367619972732*^9, 3.795367665290456*^9}, {3.79536769772675*^9, 
   3.795367703934533*^9}, {3.795367798589916*^9, 3.795367799688236*^9}, {
   3.795368450775002*^9, 3.795368453116263*^9}, {3.795368533051334*^9, 
   3.7953685424691133`*^9}, {3.7953686370247593`*^9, 
   3.7953686445600853`*^9}, {3.795368716569531*^9, 3.795368719505321*^9}, {
   3.795368828567979*^9, 3.795368840749836*^9}, {3.795368882524926*^9, 
   3.795368913272985*^9}, {3.795368944711976*^9, 3.7953689914953203`*^9}, {
   3.795369131359613*^9, 3.795369175416033*^9}, {3.795369450504478*^9, 
   3.7953696873082027`*^9}, {3.795369729822093*^9, 3.795369752312851*^9}, {
   3.795370826491104*^9, 3.7953708449068947`*^9}, {3.795370930347865*^9, 
   3.795370933150839*^9}, {3.795371042358863*^9, 3.795371066192101*^9}, {
   3.795372325388735*^9, 3.795372325622861*^9}, {3.795372831700984*^9, 
   3.795372832456367*^9}, {3.79537286918379*^9, 3.7953728715827923`*^9}, {
   3.795372945203246*^9, 3.795372955412878*^9}, {3.795373327997246*^9, 
   3.795373328299612*^9}, {3.795373493797024*^9, 3.7953734948675137`*^9}, {
   3.79537355429729*^9, 3.795373554400275*^9}, {3.795373720388839*^9, 
   3.795373758974391*^9}, {3.7953737995597*^9, 3.795373984708187*^9}, {
   3.7953741528194532`*^9, 3.795374184490809*^9}, {3.7953742659843483`*^9, 
   3.795374266413781*^9}, 3.795374307353084*^9, {3.7953744451424*^9, 
   3.795374447954384*^9}, 3.795376200465973*^9, {3.795376251923592*^9, 
   3.7953762530724363`*^9}, {3.7953768487116823`*^9, 3.795376866369493*^9}, 
   3.795377546508039*^9, {3.7954548001239157`*^9, 3.79545480920592*^9}, {
   3.795457509940629*^9, 3.795457510025456*^9}},
 CellLabel->
  "In[347]:=",ExpressionUUID->"b0ec245d-2f0b-499d-8966-e17ce4572475"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export", "Section",
 CellChangeTimes->{{3.795380772263019*^9, 
  3.795380775588015*^9}},ExpressionUUID->"d3912785-7607-43f1-81ae-\
dd6f5b849001"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"freqs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"steps", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{"1", ";;", "t"}]}], "]"}], "]"}], "//", "Flatten"}], 
          ",", "#"}], "]"}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"1", ",", 
         RowBox[{"Length", "[", "migration", "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"topFreq", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"freqs", "//", "Sort"}], "//", "Reverse"}], ")"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", "20"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"surv", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"freqs", ",", "#"}], "]"}], "&"}], "/@", "topFreq"}], "//",
          "Flatten"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"over", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"freqs", ",", 
         RowBox[{"x_", "/;", 
          RowBox[{"2000", "<", "x"}]}]}], "]"}], "//", "Flatten"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"surv", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"freqs", ",", 
         RowBox[{"x_", "/;", 
          RowBox[{"300", "<", "x", "<", "2000"}]}]}], "]"}], "//", 
       "Flatten"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", "Map", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
     "countryName", "=", 
      "\"\<S\[ATilde]o Tom\[EAcute] and Pr\[IAcute]ncipe\>\""}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"map", "=", 
      RowBox[{"MapProcess", "[", 
       RowBox[{
       "freqs", ",", " ", "pops", ",", " ", "latLon", ",", "max", ",", 
        "countryName", ",", "surv", ",", "over"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"hst", "=", 
      RowBox[{"HistProcess", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"steps", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "t"}]}], "]"}], "]"}], "//", "Flatten"}], ",", 
        "migration", ",", "maxTwo"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"out", "=", "map"}], ";", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "hst", "}"}], ",", 
          RowBox[{"{", "map", "}"}]}], "}"}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"\"\<./img/map\>\"", "<>", 
        RowBox[{"StringPadLeft", "[", 
         RowBox[{
          RowBox[{"t", "//", "ToString"}], ",", "4", ",", "\"\<0\>\""}], 
         "]"}], "<>", "\"\<.png\>\""}], ",", "out"}], "]"}]}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "sp"}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7953739365909367`*^9, 3.795373995594677*^9}, {
   3.795374132690297*^9, 3.795374133267991*^9}, {3.795374195254418*^9, 
   3.7953741954864683`*^9}, {3.795374670556163*^9, 3.7953746706809473`*^9}, {
   3.795375456639065*^9, 3.795375481934751*^9}, {3.795375553596468*^9, 
   3.795375556554677*^9}, {3.795375876179626*^9, 3.795375878624943*^9}, {
   3.795376869944372*^9, 3.795376985622775*^9}, {3.795377091449502*^9, 
   3.7953771057037067`*^9}, {3.795377166832988*^9, 3.795377184392929*^9}, {
   3.795377259521751*^9, 3.795377260109775*^9}, {3.795377523888048*^9, 
   3.795377526854053*^9}, {3.795378089671671*^9, 3.795378091649781*^9}, {
   3.795380747284708*^9, 3.79538074909931*^9}, {3.795394105482449*^9, 
   3.79539410691617*^9}, {3.795443499878549*^9, 3.7954435968258877`*^9}, {
   3.795443886897726*^9, 3.7954439000363283`*^9}, {3.7954439681054*^9, 
   3.795443987346588*^9}, {3.7954442360132523`*^9, 3.795444237233618*^9}, {
   3.795444297615027*^9, 3.7954443065585003`*^9}, {3.7954445223598347`*^9, 
   3.7954445248127127`*^9}, 3.795445589360227*^9, {3.795445818852682*^9, 
   3.795445818993617*^9}, {3.7954462530301113`*^9, 3.795446262138505*^9}, {
   3.795447025207573*^9, 3.795447025303278*^9}, {3.795447128589048*^9, 
   3.795447128836483*^9}, {3.795447209508581*^9, 3.795447209695114*^9}, {
   3.795447881513973*^9, 3.795447887363414*^9}, {3.7954511210710773`*^9, 
   3.7954511217982483`*^9}, {3.7954518709919167`*^9, 3.795451883095036*^9}, {
   3.79545198563272*^9, 3.795452059573926*^9}, {3.795452496006118*^9, 
   3.795452497344885*^9}, {3.795452848986759*^9, 3.7954528502721233`*^9}, {
   3.795457441769741*^9, 3.795457446700417*^9}, {3.7954575848706017`*^9, 
   3.795457597603168*^9}, {3.795457638922069*^9, 3.795457639457069*^9}, {
   3.795457730075609*^9, 3.7954577390490103`*^9}, {3.7954578163722773`*^9, 
   3.795457835231361*^9}, {3.795458024506691*^9, 3.795458024602127*^9}, {
   3.795459692912627*^9, 3.795459694208497*^9}, {3.795460113476707*^9, 
   3.7954601210333643`*^9}, {3.795460402810074*^9, 3.795460412325336*^9}, {
   3.795460730453985*^9, 3.795460735942675*^9}},
 CellLabel->
  "In[557]:=",ExpressionUUID->"53e1836b-2f75-4ff7-9daa-952c41f6ebaf"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{
  3.7954580262078657`*^9, 3.79545834771354*^9, 3.795458454346191*^9, 
   3.795458592506678*^9, 3.7954587909233837`*^9, 3.795458873719149*^9, 
   3.795459025790394*^9, 3.795459401192102*^9, {3.79545966331152*^9, 
   3.795459705188451*^9}, 3.795459873791317*^9, {3.795460108126752*^9, 
   3.795460123376896*^9}, {3.795460171667543*^9, 3.795460234358313*^9}, {
   3.79546027011163*^9, 3.79546038683971*^9}, 3.795460719216093*^9},
 CellLabel->
  "Out[556]=",ExpressionUUID->"b8baa91d-6088-4172-a5b4-ac1685ba1c41"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Tests", "Section",
 CellChangeTimes->{{3.795380756552993*^9, 
  3.795380759847559*^9}},ExpressionUUID->"862c8e6c-bbd1-478f-b604-\
265eaef15a24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MatrixPlot", "[", 
   RowBox[{
    RowBox[{"ReplaceDiagonal", "[", "migration", "]"}], "\[IndentingNewLine]",
     ",", 
    RowBox[{"ColorFunction", "\[Rule]", "Automatic"}], "\[IndentingNewLine]", 
    ",", 
    RowBox[{"ColorFunctionScaling", "\[Rule]", "True"}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"FrameStyle", "\[Rule]", "Thick"}], "\[IndentingNewLine]", ",", 
    RowBox[{"FrameTicks", "\[Rule]", "None"}], "\[IndentingNewLine]", ",", 
    RowBox[{"ImagePadding", "\[Rule]", "0"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.795360374624839*^9, 3.795360379539544*^9}, {
   3.795363682887294*^9, 3.7953636883197937`*^9}, {3.795363746344557*^9, 
   3.79536376412002*^9}, {3.795363802188279*^9, 3.795363850739324*^9}, {
   3.7953639409512663`*^9, 3.795363958293548*^9}, 3.795364652103305*^9, 
   3.7953667906531153`*^9},
 CellLabel->
  "In[800]:=",ExpressionUUID->"b5316ab7-6cb0-4354-9980-d6bc27fa8e07"]
}, Closed]]
},
WindowSize->{1126, 1028},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
Magnification:>0.65 Inherited,
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 154, 3, 46, "Section",ExpressionUUID->"b852c9ed-45db-4036-9364-e2e73134bb82"],
Cell[737, 27, 18942, 449, 873, "Input",ExpressionUUID->"3cd9284b-8809-416a-9918-e16787c084da"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19716, 481, 154, 3, 46, "Section",ExpressionUUID->"e0e0fe40-c61e-4d1f-810d-fb18d5e7570f"],
Cell[19873, 486, 1684, 45, 111, "Input",ExpressionUUID->"f619571b-c8a7-4707-b736-0bf5e8251a3a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21594, 536, 161, 3, 46, "Section",ExpressionUUID->"7d0a4ee2-5fa2-46c6-9918-92389b686312"],
Cell[21758, 541, 3832, 91, 126, "Input",ExpressionUUID->"b0ec245d-2f0b-499d-8966-e17ce4572475"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25627, 637, 151, 3, 46, "Section",ExpressionUUID->"d3912785-7607-43f1-81ae-dd6f5b849001"],
Cell[CellGroupData[{
Cell[25803, 644, 5380, 121, 236, "Input",ExpressionUUID->"53e1836b-2f75-4ff7-9daa-952c41f6ebaf"],
Cell[31186, 767, 565, 9, 23, "Output",ExpressionUUID->"b8baa91d-6088-4172-a5b4-ac1685ba1c41"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[31800, 782, 150, 3, 46, "Section",ExpressionUUID->"862c8e6c-bbd1-478f-b604-265eaef15a24"],
Cell[31953, 787, 984, 20, 104, "Input",ExpressionUUID->"b5316ab7-6cb0-4354-9980-d6bc27fa8e07"]
}, Closed]]
}
]
*)

